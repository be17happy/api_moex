# –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - 100%
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã (7/7)
- ‚úÖ PostgreSQL Raw Database (–ø–æ—Ä—Ç 5432)
- ‚úÖ PostgreSQL DWH (–ø–æ—Ä—Ç 5433)
- ‚úÖ AirFlow Webserver (http://localhost:8080)
- ‚úÖ AirFlow Scheduler
- ‚úÖ Dask Scheduler + Worker
- ‚úÖ Grafana (http://localhost:3000)

### 2. –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö - 100%
- ‚úÖ SQL —Å–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- ‚úÖ –°—Ö–µ–º–∞ `raw_data` —Å–æ–∑–¥–∞–Ω–∞ (4 —Ç–∞–±–ª–∏—Ü—ã)
- ‚úÖ –°—Ö–µ–º–∞ `analytics` —Å–æ–∑–¥–∞–Ω–∞ (7 —Ç–∞–±–ª–∏—Ü)
- ‚úÖ –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### 3. ETL Pipeline - 75%
- ‚úÖ DAG `moex_etl_pipeline` –Ω–∞–π–¥–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ó–∞–¥–∞—á–∞ `extract_stock_list` - SUCCESS (260 –∞–∫—Ü–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω–æ)
- ‚ö†Ô∏è –ó–∞–¥–∞—á–∞ `extract_trade_history` - SUCCESS (–Ω–æ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç)
- ‚ö†Ô∏è –ó–∞–¥–∞—á–∞ `extract_market_data` - –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚úÖ –ó–∞–¥–∞—á–∞ `log_etl_completion` - FIXED (–æ—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞)

## üìä –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ

```sql
Stocks: 260 –∑–∞–ø–∏—Å–µ–π ‚úÖ
Trade History: 0 –∑–∞–ø–∏—Å–µ–π ‚ö†Ô∏è
ETL Logs: 1 –∑–∞–ø–∏—Å—å ‚úÖ
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: DAG –Ω–µ –Ω–∞–π–¥–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω `Dockerfile.airflow` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- –°–æ–∑–¥–∞–Ω `requirements_airflow.txt`
- –ü–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ API
**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω `flows/moex_etl_dag.py`
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ "can't adapt type 'Proxy'"
**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–µ–Ω `context['execution_date']` –Ω–∞ `context['data_interval_start']`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Pendulum –æ–±—ä–µ–∫—Ç–æ–≤
- –£–¥–∞–ª–µ–Ω–∞ –ª–∏—à–Ω—è—è —Å—Ç—Ä–æ–∫–∞ "etl" –≤ –∫–æ–¥–µ

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ò—Å—Ç–æ—Ä–∏—è —Ç–æ—Ä–≥–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. API –ú–û–ï–• –º–æ–∂–µ—Ç –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π –¥–ª—è –≤—Å–µ—Ö –±—É–º–∞–≥
2. –í–æ–∑–º–æ–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API
3. –ù—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `extract_trade_history`

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏ –≤ AirFlow UI –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–µ—Ä–∏–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏.

## üéØ –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∞–∫—Ü–∏–∏
```bash
docker exec moex_postgres_raw psql -U moex_user -d moex_raw -c "
SELECT secid, shortname, lotsize
FROM raw_data.stocks
LIMIT 10;"
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Dask –æ–±—Ä–∞–±–æ—Ç–∫—É (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ)
```bash
./scripts/run_dask.sh
```

### 3. –û—Ç–∫—Ä—ã—Ç—å AirFlow UI –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```bash
open http://localhost:8080
# admin / admin
```

### 4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞—à–±–æ—Ä–¥—ã Grafana
```bash
open http://localhost:3000
# admin / admin
```

## üìà –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç **–≥–æ—Ç–æ–≤ –∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏** —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:

### –†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞
2. ‚úÖ **ETL –ø—Ä–æ—Ü–µ—Å—Å** - AirFlow DAG —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - –∞–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
4. ‚úÖ **–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - —Å—Ö–µ–º—ã —Å–æ–∑–¥–∞–Ω—ã
5. ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–ª–Ω–∞—è (9 —Ñ–∞–π–ª–æ–≤)
6. ‚úÖ **–°–∫—Ä–∏–ø—Ç—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞

### –ß—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å:
1. **Docker Compose –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - 7 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
2. **AirFlow UI** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è ETL –ø–∞–π–ø–ª–∞–π–Ω–∞
3. **–ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∑–∞–¥–∞—á** - –≤ AirFlow
4. **–î–∞–Ω–Ω—ã–µ –≤ PostgreSQL** - 260 –∞–∫—Ü–∏–π
5. **Dask Dashboard** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
6. **Grafana** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ datasources
7. **–ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π

## üìÅ –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
bigdata_project/
‚îú‚îÄ‚îÄ flows/                    # ETL –ø–∞–π–ø–ª–∞–π–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ moex_api_client.py   # API –∫–ª–∏–µ–Ω—Ç –ú–û–ï–•
‚îÇ   ‚îî‚îÄ‚îÄ moex_etl_dag.py      # AirFlow DAG
‚îú‚îÄ‚îÄ dask_jobs/               # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ dask_processor.py    # Dask –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ sql/                     # –°—Ö–µ–º—ã –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ init_raw.sql         # Raw database
‚îÇ   ‚îî‚îÄ‚îÄ init_dwh.sql         # Data Warehouse
‚îú‚îÄ‚îÄ dashboards/              # Grafana
‚îÇ   ‚îú‚îÄ‚îÄ datasources.yml      # –ò—Å—Ç–æ—á–Ω–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ moex_dashboard.json  # –î–∞—à–±–æ—Ä–¥
‚îú‚îÄ‚îÄ scripts/                 # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ quick_check.sh       # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ run_etl.sh          # –ó–∞–ø—É—Å–∫ ETL
‚îÇ   ‚îî‚îÄ‚îÄ run_dask.sh         # –ó–∞–ø—É—Å–∫ Dask
‚îú‚îÄ‚îÄ config/                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ airflow_connections.sh
‚îú‚îÄ‚îÄ Dockerfile.airflow       # –ö–∞—Å—Ç–æ–º–Ω—ã–π AirFlow
‚îú‚îÄ‚îÄ docker-compose.yml       # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–æ **9 —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**

1. **README.md** - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (2200+ —Å—Ç—Ä–æ–∫)
2. **QUICKSTART.md** - –ø–æ—à–∞–≥–æ–≤—ã–π –∑–∞–ø—É—Å–∫
3. **CHEATSHEET.md** - –∫–æ–º–∞–Ω–¥—ã –∏ –ø—Ä–∏–º–µ—Ä—ã
4. **NEXT_STEPS.md** - –ø–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è
5. **TROUBLESHOOTING.md** - —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
6. **STATUS.md** - –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å
7. **CURRENT_STATUS.md** - —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
8. **SOLUTION_SUMMARY.md** - –∫–∞–∫ —Ä–µ—à–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã
9. **FINAL_STATUS.md** - –∏—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

## üî¨ –î–ª—è –æ—Ç—á–µ—Ç–∞

### –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
- ‚úÖ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–ª–Ω–∞—è Big Data –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω ETL –ø—Ä–æ—Ü–µ—Å—Å —Å Apache AirFlow
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL (Raw + DWH)
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å Dask
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å Grafana
- ‚úÖ –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω–æ —Å Docker
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- Apache AirFlow 2.7.3
- PostgreSQL 15
- Dask
- Grafana 10.2
- Docker & Docker Compose
- Python 3.11
- MOEX API (apimoex)

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞:
- –°—Ç—Ä–æ–∫ –∫–æ–¥–∞: ~2000+
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: 7
- –¢–∞–±–ª–∏—Ü –ë–î: 11
- DAG –∑–∞–¥–∞—á: 5
- –î–æ–∫—É–º–µ–Ω—Ç–æ–≤: 9
- –°–∫—Ä–∏–ø—Ç–æ–≤: 7

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (–¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è):
1. –û—Ç–ª–∞–¥–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏—Å—Ç–æ—Ä–∏–∏ —Ç–æ—Ä–≥–æ–≤
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Dask –æ–±—Ä–∞–±–æ—Ç–∫—É
3. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–ª—è –æ—Ç—á–µ—Ç–∞
4. –ù–∞–ø–∏—Å–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (–¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è):
1. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –º–µ—Ç—Ä–∏–∫
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –≤ Grafana
3. –î–æ–±–∞–≤–∏—Ç—å ML –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## ‚ú® –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω!**

–ü–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞, ETL –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω.

**–ì–æ—Ç–æ–≤–æ –∫:**
- ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ó–∞—â–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –î–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é

---

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~2.5 —á–∞—Å–∞
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 24.12.2025 23:30 MSK
